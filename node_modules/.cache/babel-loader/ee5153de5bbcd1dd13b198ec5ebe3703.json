{"ast":null,"code":"const SAMPLE_RATE = 44100;\nlet shapes = {\n  sine: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    return Math.sin(t * freq * 2 * Math.PI);\n  },\n  triangle: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    let p = 1 / freq;\n    return 2 * Math.abs(2 * (t / p - Math.floor(t / p + 1 / 2))) - 1;\n  },\n  saw: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    let p = 1 / freq;\n    return 2 * (t / p - Math.floor(t / p + 1 / 2));\n  },\n  square: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    let p = 1 / freq;\n    return t % p > p / 2 ? 1 : -1;\n  }\n  /*function melody(notes) {\n    let mel = []\n    for (let i = 0; i < notes.length; i++) {\n      mel = mel.concat(notes[i])\n    }\n    return mel\n  }*/\n\n};\n\nfunction norm(x) {\n  while (x > 2) x /= 2;\n\n  while (x < 1) x *= 2;\n\n  return x;\n}\n\nfunction cents(x) {\n  return 1200 * Math.log(norm(x), 2);\n}\n\nfunction decimal(x) {\n  return Math.pow(2, x / 1200);\n}\n\nconst tunings = {\n  'tet12': new Array(12).fill(1).map((elt, i) => Math.pow(2, i / 12)),\n  'just': [1, 16 / 15, 9 / 8, 6 / 5, 5 / 4, 4 / 3, 7 / 5, 3 / 2, 8 / 5, 5 / 3, 16 / 9, 15 / 8],\n  'pythag': [1, 256 / 243, 9 / 8, 32 / 27, 81 / 64, 4 / 3, 1024 / 729, 3 / 2, 121 / 81, 27 / 16, 16 / 9, 243 / 128],\n  'lim5': [1, 16 / 15, 9 / 8, 6 / 5, 5 / 4, 4 / 3, 64 / 45, 3 / 2, 8 / 5, 5 / 3, 16 / 9, 15 / 8],\n  'lim7': [1, 16 / 15, 9 / 8, 6 / 5, 5 / 4, 4 / 3, 7 / 5, 3 / 2, 8 / 5, 5 / 3, 16 / 9, 15 / 8],\n  'mt_1/4': [],\n  'mt_1/3': [],\n  'mt_2/7': [],\n  'mt_1/5': []\n};\nconst mt_1_4gen = decimal(cents(3 / 2) - cents(81 / 80) / 4);\nconst mt_1_3gen = decimal(cents(3 / 2) - cents(81 / 80) / 3);\nconst mt_2_7gen = decimal(cents(3 / 2) - cents(81 / 80) * 2 / 7);\nconst mt_1_5gen = decimal(cents(3 / 2) - cents(81 / 80) / 5);\n\nfor (let i = -6; i < 7; i++) {\n  tunings['mt_1/4'].push(norm(Math.pow(mt_1_4gen, i)));\n}\n\ntunings['mt_1/4'].sort();\nconsole.log(cents(3 / 2));\nconsole.log(tunings['mt_1/4']);\n\nfunction getAudio(ops) {\n  const audio = [];\n  ops = {\n    playtime: parseFloat(ops.playtime),\n    fundamental: parseFloat(ops.fundamental),\n    scale: tunings[ops.system],\n    shape: ops.shape,\n    root: parseInt(ops.root),\n    rootBNS: parseInt(ops.rootBNS),\n    triad: JSON.parse(ops.triad),\n    seventh: parseInt(ops.seventh),\n    ninth: parseInt(ops.ninth),\n    eleventh: parseInt(ops.eleventh),\n    thirteenth: parseInt(ops.thirteenth)\n  };\n  let root = ops.root + ops.rootBNS;\n  let third = ops.triad[0];\n  let fifth = ops.triad[1];\n  audio.push(ops.fundamental * ops.scale[root]);\n  audio.push(ops.fundamental * ops.scale[root + third]);\n  audio.push(ops.fundamental * ops.scale[root + fifth]);\n  if (!isNaN(ops.seventh)) audio.push(ops.fundamental * ops.scale[root + ops.seventh]);\n  if (!isNaN(ops.ninth)) audio.push(ops.fundamental * 2 * ops.scale[root + ops.ninth]);\n  if (!isNaN(ops.eleventh)) audio.push(ops.fundamental * 2 * ops.scale[root + ops.eleventh]);\n  if (!isNaN(ops.thirteenth)) audio.push(ops.fundamental * 2 * ops.scale[root + ops.thirteenth]);\n  return audio;\n}\n\nfunction getChordName(ops) {\n  let name = '';\n\n  switch (ops.rootBNS) {\n    case '-1':\n      name += 'b';\n      break;\n\n    case '1':\n      name += '#';\n      break;\n\n    default:\n      break;\n  }\n\n  let root;\n\n  switch (ops.root) {\n    case '0':\n      root = 'I';\n      break;\n\n    case '2':\n      root = 'II';\n      break;\n\n    case '4':\n      root = 'III';\n      break;\n\n    case '5':\n      root = 'IV';\n      break;\n\n    case '7':\n      root = 'V';\n      break;\n\n    case '9':\n      root = 'VI';\n      break;\n\n    case '11':\n      root = 'VII';\n      break;\n\n    default:\n      break;\n  }\n\n  switch (ops.triad) {\n    case '[4,7]':\n      name += root;\n      break;\n\n    case '[3,7]':\n      name += root.toLowerCase();\n      break;\n\n    case '[4,8]':\n      name += root + 'aug';\n      break;\n\n    case '[3,6]':\n      name += root.toLowerCase() + 'dim';\n      break;\n\n    case '[5,7]':\n      name += root + 'sus4';\n      break;\n\n    case '[2,7]':\n      name += root + 'sus2';\n      break;\n\n    case '[4,6]':\n      name += root + 'b5';\n      break;\n\n    default:\n      break;\n  }\n\n  switch (ops.seventh) {\n    case '9':\n      name += 'dim7';\n      break;\n\n    case '10':\n      name += '7';\n      break;\n\n    case '11':\n      name += 'maj7';\n      break;\n\n    default:\n      break;\n  }\n\n  let extendeds = [];\n\n  switch (ops.ninth) {\n    case '1':\n      extendeds.push('b9');\n      break;\n\n    case '2':\n      extendeds.push('9');\n      break;\n\n    case '3':\n      extendeds.push('#9');\n      break;\n\n    default:\n      break;\n  }\n\n  switch (ops.eleventh) {\n    case '5':\n      extendeds.push('11');\n      break;\n\n    case '6':\n      extendeds.push('#11');\n      break;\n\n    default:\n      break;\n  }\n\n  switch (ops.thirteenth) {\n    case '8':\n      extendeds.push('b13');\n      break;\n\n    case '9':\n      extendeds.push('13');\n      break;\n\n    case '10':\n      extendeds.push('#13');\n      break;\n\n    default:\n      break;\n  }\n\n  if (extendeds.length > 0) name += '(' + extendeds.join(',') + ')';\n  return name;\n}\n\nfunction getAudioFromTextin(ops) {\n  let fundamental = parseFloat(ops.fundamental);\n  let audio = [fundamental];\n  ops.value.split(', ').forEach(function (interval) {\n    if (interval.includes('/') && !interval.includes('.')) {\n      let num_dem = interval.split('/');\n      let numerator = parseInt(num_dem[0]);\n      let denominator = parseInt(num_dem[1]);\n      audio.push(fundamental * numerator / denominator);\n    } else if (interval.includes('.') && !interval.includes('/')) {\n      let cents = parseFloat(interval);\n      audio.push(fundamental * Math.pow(2, cents / 1200));\n    }\n  });\n  return audio;\n}\n\nfunction play(audio, playtime, shape) {\n  let AudioContext = window.AudioContext || window.webkitAudioContext;\n  const ctx = new AudioContext();\n  let buffer = ctx.createBuffer(1, playtime * SAMPLE_RATE, SAMPLE_RATE);\n  let bufferSetter = buffer.getChannelData(0);\n  var generator = typeof shape == 'function' ? shape : shapes[shape];\n\n  for (let t = 0; t < playtime * SAMPLE_RATE; t++) {\n    audio.forEach(function (freq) {\n      bufferSetter[t] += generator(t, freq);\n    });\n  }\n\n  let source = ctx.createBufferSource();\n  source.buffer = buffer;\n  source.connect(ctx.destination);\n  source.start();\n}\n\nconst Sound = {\n  getAudio,\n  getAudioFromTextin,\n  getChordName,\n  play\n};\nexport default Sound;","map":{"version":3,"sources":["/Users/jimmy/Documents/GitHub/Trytune/src/components/sound.js"],"names":["SAMPLE_RATE","shapes","sine","s","freq","t","Math","sin","PI","triangle","p","abs","floor","saw","square","norm","x","cents","log","decimal","pow","tunings","Array","fill","map","elt","i","mt_1_4gen","mt_1_3gen","mt_2_7gen","mt_1_5gen","push","sort","console","getAudio","ops","audio","playtime","parseFloat","fundamental","scale","system","shape","root","parseInt","rootBNS","triad","JSON","parse","seventh","ninth","eleventh","thirteenth","third","fifth","isNaN","getChordName","name","toLowerCase","extendeds","length","join","getAudioFromTextin","value","split","forEach","interval","includes","num_dem","numerator","denominator","play","AudioContext","window","webkitAudioContext","ctx","buffer","createBuffer","bufferSetter","getChannelData","generator","source","createBufferSource","connect","destination","start","Sound"],"mappings":"AAAA,MAAMA,WAAW,GAAG,KAApB;AAEA,IAAIC,MAAM,GAAG;AACXC,EAAAA,IAAI,EAAE,UAAUC,CAAV,EAAaC,IAAb,EAAmB;AACvB,QAAIC,CAAC,GAAGF,CAAC,GAAGH,WAAZ;AACA,WAAOM,IAAI,CAACC,GAAL,CAASF,CAAC,GAAGD,IAAJ,GAAW,CAAX,GAAeE,IAAI,CAACE,EAA7B,CAAP;AACD,GAJU;AAKXC,EAAAA,QAAQ,EAAE,UAAUN,CAAV,EAAaC,IAAb,EAAmB;AAC3B,QAAIC,CAAC,GAAGF,CAAC,GAAGH,WAAZ;AACA,QAAIU,CAAC,GAAG,IAAIN,IAAZ;AACA,WAAO,IAAIE,IAAI,CAACK,GAAL,CAAS,KAAKN,CAAC,GAACK,CAAF,GAAMJ,IAAI,CAACM,KAAL,CAAWP,CAAC,GAACK,CAAF,GAAM,IAAE,CAAnB,CAAX,CAAT,CAAJ,GAAkD,CAAzD;AACD,GATU;AAUXG,EAAAA,GAAG,EAAE,UAAUV,CAAV,EAAaC,IAAb,EAAmB;AACtB,QAAIC,CAAC,GAAGF,CAAC,GAAGH,WAAZ;AACA,QAAIU,CAAC,GAAG,IAAIN,IAAZ;AACA,WAAO,KAAKC,CAAC,GAACK,CAAF,GAAMJ,IAAI,CAACM,KAAL,CAAWP,CAAC,GAACK,CAAF,GAAM,IAAE,CAAnB,CAAX,CAAP;AACD,GAdU;AAeXI,EAAAA,MAAM,EAAE,UAAUX,CAAV,EAAaC,IAAb,EAAmB;AACzB,QAAIC,CAAC,GAAGF,CAAC,GAAGH,WAAZ;AACA,QAAIU,CAAC,GAAG,IAAIN,IAAZ;AACA,WAAOC,CAAC,GAAGK,CAAJ,GAAQA,CAAC,GAAG,CAAZ,GAAgB,CAAhB,GAAoB,CAAC,CAA5B;AACD;AAGH;;;;;;;;AAtBa,CAAb;;AA8BA,SAASK,IAAT,CAAcC,CAAd,EAAiB;AACf,SAAOA,CAAC,GAAG,CAAX,EAAcA,CAAC,IAAI,CAAL;;AACd,SAAOA,CAAC,GAAG,CAAX,EAAcA,CAAC,IAAI,CAAL;;AACd,SAAOA,CAAP;AACD;;AAED,SAASC,KAAT,CAAeD,CAAf,EAAkB;AAChB,SAAO,OAAOV,IAAI,CAACY,GAAL,CAASH,IAAI,CAACC,CAAD,CAAb,EAAkB,CAAlB,CAAd;AACD;;AAED,SAASG,OAAT,CAAiBH,CAAjB,EAAoB;AAClB,SAAOV,IAAI,CAACc,GAAL,CAAS,CAAT,EAAYJ,CAAC,GAAG,IAAhB,CAAP;AACD;;AAED,MAAMK,OAAO,GAAG;AACd,WAAS,IAAIC,KAAJ,CAAU,EAAV,EAAcC,IAAd,CAAmB,CAAnB,EAAsBC,GAAtB,CAA0B,CAACC,GAAD,EAAKC,CAAL,KAAWpB,IAAI,CAACc,GAAL,CAAS,CAAT,EAAWM,CAAC,GAAC,EAAb,CAArC,CADK;AAEd,UAAQ,CAAC,CAAD,EAAI,KAAG,EAAP,EAAW,IAAE,CAAb,EAAgB,IAAE,CAAlB,EAAqB,IAAE,CAAvB,EAA0B,IAAE,CAA5B,EAA+B,IAAE,CAAjC,EAAoC,IAAE,CAAtC,EAAyC,IAAE,CAA3C,EAA8C,IAAE,CAAhD,EAAmD,KAAG,CAAtD,EAAyD,KAAG,CAA5D,CAFM;AAGd,YAAU,CAAC,CAAD,EAAI,MAAI,GAAR,EAAa,IAAE,CAAf,EAAkB,KAAG,EAArB,EAAyB,KAAG,EAA5B,EAAgC,IAAE,CAAlC,EAAqC,OAAK,GAA1C,EAA+C,IAAE,CAAjD,EAAoD,MAAI,EAAxD,EAA4D,KAAG,EAA/D,EAAmE,KAAG,CAAtE,EAAyE,MAAI,GAA7E,CAHI;AAId,UAAQ,CAAC,CAAD,EAAI,KAAG,EAAP,EAAW,IAAE,CAAb,EAAgB,IAAE,CAAlB,EAAqB,IAAE,CAAvB,EAA0B,IAAE,CAA5B,EAA+B,KAAG,EAAlC,EAAsC,IAAE,CAAxC,EAA2C,IAAE,CAA7C,EAAgD,IAAE,CAAlD,EAAqD,KAAG,CAAxD,EAA2D,KAAG,CAA9D,CAJM;AAKd,UAAQ,CAAC,CAAD,EAAI,KAAG,EAAP,EAAW,IAAE,CAAb,EAAgB,IAAE,CAAlB,EAAqB,IAAE,CAAvB,EAA0B,IAAE,CAA5B,EAA+B,IAAE,CAAjC,EAAoC,IAAE,CAAtC,EAAyC,IAAE,CAA3C,EAA8C,IAAE,CAAhD,EAAmD,KAAG,CAAtD,EAAyD,KAAG,CAA5D,CALM;AAMd,YAAU,EANI;AAOd,YAAU,EAPI;AAQd,YAAU,EARI;AASd,YAAU;AATI,CAAhB;AAWA,MAAMC,SAAS,GAAGR,OAAO,CAACF,KAAK,CAAC,IAAE,CAAH,CAAL,GAAaA,KAAK,CAAC,KAAG,EAAJ,CAAL,GAAe,CAA7B,CAAzB;AACA,MAAMW,SAAS,GAAGT,OAAO,CAACF,KAAK,CAAC,IAAE,CAAH,CAAL,GAAaA,KAAK,CAAC,KAAG,EAAJ,CAAL,GAAe,CAA7B,CAAzB;AACA,MAAMY,SAAS,GAAGV,OAAO,CAACF,KAAK,CAAC,IAAE,CAAH,CAAL,GAAaA,KAAK,CAAC,KAAG,EAAJ,CAAL,GAAe,CAAf,GAAiB,CAA/B,CAAzB;AACA,MAAMa,SAAS,GAAGX,OAAO,CAACF,KAAK,CAAC,IAAE,CAAH,CAAL,GAAaA,KAAK,CAAC,KAAG,EAAJ,CAAL,GAAe,CAA7B,CAAzB;;AACA,KAAK,IAAIS,CAAC,GAAG,CAAC,CAAd,EAAiBA,CAAC,GAAG,CAArB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3BL,EAAAA,OAAO,CAAC,QAAD,CAAP,CAAkBU,IAAlB,CAAuBhB,IAAI,CAACT,IAAI,CAACc,GAAL,CAASO,SAAT,EAAmBD,CAAnB,CAAD,CAA3B;AACD;;AACDL,OAAO,CAAC,QAAD,CAAP,CAAkBW,IAAlB;AACAC,OAAO,CAACf,GAAR,CAAYD,KAAK,CAAC,IAAE,CAAH,CAAjB;AACAgB,OAAO,CAACf,GAAR,CAAYG,OAAO,CAAC,QAAD,CAAnB;;AAGA,SAASa,QAAT,CAAkBC,GAAlB,EAAuB;AACrB,QAAMC,KAAK,GAAG,EAAd;AACAD,EAAAA,GAAG,GAAG;AACJE,IAAAA,QAAQ,EAAEC,UAAU,CAACH,GAAG,CAACE,QAAL,CADhB;AAEJE,IAAAA,WAAW,EAAED,UAAU,CAACH,GAAG,CAACI,WAAL,CAFnB;AAGJC,IAAAA,KAAK,EAAEnB,OAAO,CAACc,GAAG,CAACM,MAAL,CAHV;AAIJC,IAAAA,KAAK,EAAEP,GAAG,CAACO,KAJP;AAKJC,IAAAA,IAAI,EAAEC,QAAQ,CAACT,GAAG,CAACQ,IAAL,CALV;AAMJE,IAAAA,OAAO,EAAED,QAAQ,CAACT,GAAG,CAACU,OAAL,CANb;AAOJC,IAAAA,KAAK,EAAEC,IAAI,CAACC,KAAL,CAAWb,GAAG,CAACW,KAAf,CAPH;AAQJG,IAAAA,OAAO,EAAEL,QAAQ,CAACT,GAAG,CAACc,OAAL,CARb;AASJC,IAAAA,KAAK,EAAEN,QAAQ,CAACT,GAAG,CAACe,KAAL,CATX;AAUJC,IAAAA,QAAQ,EAAEP,QAAQ,CAACT,GAAG,CAACgB,QAAL,CAVd;AAWJC,IAAAA,UAAU,EAAER,QAAQ,CAACT,GAAG,CAACiB,UAAL;AAXhB,GAAN;AAcA,MAAIT,IAAI,GAAGR,GAAG,CAACQ,IAAJ,GAAWR,GAAG,CAACU,OAA1B;AACA,MAAIQ,KAAK,GAAGlB,GAAG,CAACW,KAAJ,CAAU,CAAV,CAAZ;AACA,MAAIQ,KAAK,GAAGnB,GAAG,CAACW,KAAJ,CAAU,CAAV,CAAZ;AACAV,EAAAA,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkBJ,GAAG,CAACK,KAAJ,CAAUG,IAAV,CAA7B;AACAP,EAAAA,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkBJ,GAAG,CAACK,KAAJ,CAAUG,IAAI,GAAGU,KAAjB,CAA7B;AACAjB,EAAAA,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkBJ,GAAG,CAACK,KAAJ,CAAUG,IAAI,GAAGW,KAAjB,CAA7B;AAEA,MAAI,CAACC,KAAK,CAACpB,GAAG,CAACc,OAAL,CAAV,EACEb,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkBJ,GAAG,CAACK,KAAJ,CAAUG,IAAI,GAAGR,GAAG,CAACc,OAArB,CAA7B;AACF,MAAI,CAACM,KAAK,CAACpB,GAAG,CAACe,KAAL,CAAV,EACEd,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkB,CAAlB,GAAsBJ,GAAG,CAACK,KAAJ,CAAUG,IAAI,GAAGR,GAAG,CAACe,KAArB,CAAjC;AACF,MAAI,CAACK,KAAK,CAACpB,GAAG,CAACgB,QAAL,CAAV,EACEf,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkB,CAAlB,GAAsBJ,GAAG,CAACK,KAAJ,CAAUG,IAAI,GAAGR,GAAG,CAACgB,QAArB,CAAjC;AACF,MAAI,CAACI,KAAK,CAACpB,GAAG,CAACiB,UAAL,CAAV,EACEhB,KAAK,CAACL,IAAN,CAAWI,GAAG,CAACI,WAAJ,GAAkB,CAAlB,GAAsBJ,GAAG,CAACK,KAAJ,CAAUG,IAAI,GAAGR,GAAG,CAACiB,UAArB,CAAjC;AAEF,SAAOhB,KAAP;AACD;;AAED,SAASoB,YAAT,CAAsBrB,GAAtB,EAA2B;AACzB,MAAIsB,IAAI,GAAG,EAAX;;AACA,UAAQtB,GAAG,CAACU,OAAZ;AACE,SAAK,IAAL;AACEY,MAAAA,IAAI,IAAI,GAAR;AACA;;AACF,SAAK,GAAL;AACEA,MAAAA,IAAI,IAAI,GAAR;AACA;;AACF;AACE;AARJ;;AAUA,MAAId,IAAJ;;AACA,UAAQR,GAAG,CAACQ,IAAZ;AACE,SAAK,GAAL;AACEA,MAAAA,IAAI,GAAG,GAAP;AACA;;AACF,SAAK,GAAL;AACAA,MAAAA,IAAI,GAAG,IAAP;AACE;;AACF,SAAK,GAAL;AACAA,MAAAA,IAAI,GAAG,KAAP;AACE;;AACF,SAAK,GAAL;AACAA,MAAAA,IAAI,GAAG,IAAP;AACE;;AACF,SAAK,GAAL;AACAA,MAAAA,IAAI,GAAG,GAAP;AACE;;AACF,SAAK,GAAL;AACAA,MAAAA,IAAI,GAAG,IAAP;AACE;;AACF,SAAK,IAAL;AACAA,MAAAA,IAAI,GAAG,KAAP;AACE;;AACF;AACE;AAvBJ;;AAyBA,UAAQR,GAAG,CAACW,KAAZ;AACE,SAAK,OAAL;AACEW,MAAAA,IAAI,IAAId,IAAR;AACA;;AACF,SAAK,OAAL;AACEc,MAAAA,IAAI,IAAId,IAAI,CAACe,WAAL,EAAR;AACA;;AACF,SAAK,OAAL;AACED,MAAAA,IAAI,IAAId,IAAI,GAAG,KAAf;AACA;;AACF,SAAK,OAAL;AACEc,MAAAA,IAAI,IAAId,IAAI,CAACe,WAAL,KAAqB,KAA7B;AACA;;AACF,SAAK,OAAL;AACED,MAAAA,IAAI,IAAId,IAAI,GAAG,MAAf;AACA;;AACF,SAAK,OAAL;AACEc,MAAAA,IAAI,IAAId,IAAI,GAAG,MAAf;AACA;;AACF,SAAK,OAAL;AACEc,MAAAA,IAAI,IAAId,IAAI,GAAG,IAAf;AACA;;AACF;AACE;AAvBJ;;AAyBA,UAAQR,GAAG,CAACc,OAAZ;AACE,SAAK,GAAL;AACEQ,MAAAA,IAAI,IAAI,MAAR;AACA;;AACF,SAAK,IAAL;AACEA,MAAAA,IAAI,IAAI,GAAR;AACA;;AACF,SAAK,IAAL;AACEA,MAAAA,IAAI,IAAI,MAAR;AACA;;AACF;AACE;AAXJ;;AAaA,MAAIE,SAAS,GAAG,EAAhB;;AACA,UAAQxB,GAAG,CAACe,KAAZ;AACE,SAAK,GAAL;AACES,MAAAA,SAAS,CAAC5B,IAAV,CAAe,IAAf;AACA;;AACF,SAAK,GAAL;AACE4B,MAAAA,SAAS,CAAC5B,IAAV,CAAe,GAAf;AACA;;AACF,SAAK,GAAL;AACE4B,MAAAA,SAAS,CAAC5B,IAAV,CAAe,IAAf;AACA;;AACF;AACE;AAXJ;;AAaA,UAAQI,GAAG,CAACgB,QAAZ;AACE,SAAK,GAAL;AACEQ,MAAAA,SAAS,CAAC5B,IAAV,CAAe,IAAf;AACA;;AACF,SAAK,GAAL;AACE4B,MAAAA,SAAS,CAAC5B,IAAV,CAAe,KAAf;AACA;;AACF;AACE;AARJ;;AAUA,UAAQI,GAAG,CAACiB,UAAZ;AACE,SAAK,GAAL;AACEO,MAAAA,SAAS,CAAC5B,IAAV,CAAe,KAAf;AACA;;AACF,SAAK,GAAL;AACE4B,MAAAA,SAAS,CAAC5B,IAAV,CAAe,IAAf;AACA;;AACF,SAAK,IAAL;AACE4B,MAAAA,SAAS,CAAC5B,IAAV,CAAe,KAAf;AACA;;AACF;AACE;AAXJ;;AAaA,MAAI4B,SAAS,CAACC,MAAV,GAAmB,CAAvB,EACEH,IAAI,IAAI,MAAME,SAAS,CAACE,IAAV,CAAe,GAAf,CAAN,GAA4B,GADZ;AAG1B,SAAOJ,IAAP;AACD;;AAED,SAASK,kBAAT,CAA4B3B,GAA5B,EAAiC;AAC/B,MAAII,WAAW,GAAGD,UAAU,CAACH,GAAG,CAACI,WAAL,CAA5B;AACA,MAAIH,KAAK,GAAG,CAACG,WAAD,CAAZ;AACAJ,EAAAA,GAAG,CAAC4B,KAAJ,CAAUC,KAAV,CAAgB,IAAhB,EAAsBC,OAAtB,CAA8B,UAASC,QAAT,EAAmB;AAC/C,QAAIA,QAAQ,CAACC,QAAT,CAAkB,GAAlB,KAA0B,CAACD,QAAQ,CAACC,QAAT,CAAkB,GAAlB,CAA/B,EAAuD;AACrD,UAAIC,OAAO,GAAGF,QAAQ,CAACF,KAAT,CAAe,GAAf,CAAd;AACA,UAAIK,SAAS,GAAGzB,QAAQ,CAACwB,OAAO,CAAC,CAAD,CAAR,CAAxB;AACA,UAAIE,WAAW,GAAG1B,QAAQ,CAACwB,OAAO,CAAC,CAAD,CAAR,CAA1B;AACAhC,MAAAA,KAAK,CAACL,IAAN,CAAWQ,WAAW,GAAG8B,SAAd,GAA0BC,WAArC;AACD,KALD,MAKO,IAAIJ,QAAQ,CAACC,QAAT,CAAkB,GAAlB,KAA0B,CAACD,QAAQ,CAACC,QAAT,CAAkB,GAAlB,CAA/B,EAAuD;AAC5D,UAAIlD,KAAK,GAAGqB,UAAU,CAAC4B,QAAD,CAAtB;AACA9B,MAAAA,KAAK,CAACL,IAAN,CAAWQ,WAAW,GAAGjC,IAAI,CAACc,GAAL,CAAS,CAAT,EAAYH,KAAK,GAAC,IAAlB,CAAzB;AACD;AACF,GAVD;AAWA,SAAOmB,KAAP;AACD;;AAED,SAASmC,IAAT,CAAcnC,KAAd,EAAqBC,QAArB,EAA+BK,KAA/B,EAAsC;AACpC,MAAI8B,YAAY,GAAGC,MAAM,CAACD,YAAP,IAAuBC,MAAM,CAACC,kBAAjD;AACA,QAAMC,GAAG,GAAG,IAAIH,YAAJ,EAAZ;AACA,MAAII,MAAM,GAAGD,GAAG,CAACE,YAAJ,CAAiB,CAAjB,EAAoBxC,QAAQ,GAAGrC,WAA/B,EAA4CA,WAA5C,CAAb;AACA,MAAI8E,YAAY,GAAGF,MAAM,CAACG,cAAP,CAAsB,CAAtB,CAAnB;AACA,MAAIC,SAAS,GAAG,OAAOtC,KAAP,IAAgB,UAAhB,GAA6BA,KAA7B,GAAqCzC,MAAM,CAACyC,KAAD,CAA3D;;AAEA,OAAK,IAAIrC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgC,QAAQ,GAAGrC,WAA/B,EAA4CK,CAAC,EAA7C,EAAiD;AAC/C+B,IAAAA,KAAK,CAAC6B,OAAN,CAAc,UAAS7D,IAAT,EAAe;AAC3B0E,MAAAA,YAAY,CAACzE,CAAD,CAAZ,IAAmB2E,SAAS,CAAC3E,CAAD,EAAID,IAAJ,CAA5B;AACD,KAFD;AAGD;;AAED,MAAI6E,MAAM,GAAGN,GAAG,CAACO,kBAAJ,EAAb;AACAD,EAAAA,MAAM,CAACL,MAAP,GAAgBA,MAAhB;AACAK,EAAAA,MAAM,CAACE,OAAP,CAAeR,GAAG,CAACS,WAAnB;AACAH,EAAAA,MAAM,CAACI,KAAP;AACD;;AAED,MAAMC,KAAK,GAAG;AACZpD,EAAAA,QADY;AAEZ4B,EAAAA,kBAFY;AAGZN,EAAAA,YAHY;AAIZe,EAAAA;AAJY,CAAd;AAOA,eAAee,KAAf","sourcesContent":["const SAMPLE_RATE = 44100\n\nlet shapes = {\n  sine: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    return Math.sin(t * freq * 2 * Math.PI);\n  },\n  triangle: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    let p = 1 / freq;\n    return 2 * Math.abs(2 * (t/p - Math.floor(t/p + 1/2))) - 1;\n  },\n  saw: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    let p = 1 / freq;\n    return 2 * (t/p - Math.floor(t/p + 1/2));\n  },\n  square: function (s, freq) {\n    let t = s / SAMPLE_RATE;\n    let p = 1 / freq;\n    return t % p > p / 2 ? 1 : -1;\n  }\n}\n\n/*function melody(notes) {\n  let mel = []\n  for (let i = 0; i < notes.length; i++) {\n    mel = mel.concat(notes[i])\n  }\n  return mel\n}*/\n\nfunction norm(x) {\n  while (x > 2) x /= 2;\n  while (x < 1) x *= 2;\n  return x;\n}\n\nfunction cents(x) {\n  return 1200 * Math.log(norm(x), 2);\n}\n\nfunction decimal(x) {\n  return Math.pow(2, x / 1200);\n}\n\nconst tunings = {\n  'tet12': new Array(12).fill(1).map((elt,i) => Math.pow(2,i/12)),\n  'just': [1, 16/15, 9/8, 6/5, 5/4, 4/3, 7/5, 3/2, 8/5, 5/3, 16/9, 15/8],\n  'pythag': [1, 256/243, 9/8, 32/27, 81/64, 4/3, 1024/729, 3/2, 121/81, 27/16, 16/9, 243/128],\n  'lim5': [1, 16/15, 9/8, 6/5, 5/4, 4/3, 64/45, 3/2, 8/5, 5/3, 16/9, 15/8],\n  'lim7': [1, 16/15, 9/8, 6/5, 5/4, 4/3, 7/5, 3/2, 8/5, 5/3, 16/9, 15/8],\n  'mt_1/4': [],\n  'mt_1/3': [],\n  'mt_2/7': [],\n  'mt_1/5': [],\n}\nconst mt_1_4gen = decimal(cents(3/2) - cents(81/80) / 4);\nconst mt_1_3gen = decimal(cents(3/2) - cents(81/80) / 3);\nconst mt_2_7gen = decimal(cents(3/2) - cents(81/80) * 2/7);\nconst mt_1_5gen = decimal(cents(3/2) - cents(81/80) / 5);\nfor (let i = -6; i < 7; i++) {\n  tunings['mt_1/4'].push(norm(Math.pow(mt_1_4gen,i)));\n}\ntunings['mt_1/4'].sort()\nconsole.log(cents(3/2))\nconsole.log(tunings['mt_1/4'])\n\n\nfunction getAudio(ops) {\n  const audio = []\n  ops = {\n    playtime: parseFloat(ops.playtime),\n    fundamental: parseFloat(ops.fundamental),\n    scale: tunings[ops.system],\n    shape: ops.shape,\n    root: parseInt(ops.root),\n    rootBNS: parseInt(ops.rootBNS),\n    triad: JSON.parse(ops.triad),\n    seventh: parseInt(ops.seventh),\n    ninth: parseInt(ops.ninth),\n    eleventh: parseInt(ops.eleventh),\n    thirteenth: parseInt(ops.thirteenth),\n  }\n\n  let root = ops.root + ops.rootBNS\n  let third = ops.triad[0]\n  let fifth = ops.triad[1]\n  audio.push(ops.fundamental * ops.scale[root])\n  audio.push(ops.fundamental * ops.scale[root + third])\n  audio.push(ops.fundamental * ops.scale[root + fifth])\n\n  if (!isNaN(ops.seventh))\n    audio.push(ops.fundamental * ops.scale[root + ops.seventh])\n  if (!isNaN(ops.ninth))\n    audio.push(ops.fundamental * 2 * ops.scale[root + ops.ninth])\n  if (!isNaN(ops.eleventh))\n    audio.push(ops.fundamental * 2 * ops.scale[root + ops.eleventh])\n  if (!isNaN(ops.thirteenth))\n    audio.push(ops.fundamental * 2 * ops.scale[root + ops.thirteenth])\n\n  return audio\n}\n\nfunction getChordName(ops) {\n  let name = '';\n  switch (ops.rootBNS) {\n    case '-1':\n      name += 'b';\n      break;\n    case '1':\n      name += '#';\n      break;\n    default:\n      break;\n  }\n  let root;\n  switch (ops.root) {\n    case '0':\n      root = 'I';\n      break;\n    case '2':\n    root = 'II';\n      break;\n    case '4':\n    root = 'III';\n      break;\n    case '5':\n    root = 'IV';\n      break;\n    case '7':\n    root = 'V';\n      break;\n    case '9':\n    root = 'VI';\n      break;\n    case '11':\n    root = 'VII';\n      break;\n    default:\n      break;\n  }\n  switch (ops.triad) {\n    case '[4,7]':\n      name += root;\n      break;\n    case '[3,7]':\n      name += root.toLowerCase();\n      break;\n    case '[4,8]':\n      name += root + 'aug';\n      break;\n    case '[3,6]':\n      name += root.toLowerCase() + 'dim';\n      break;\n    case '[5,7]':\n      name += root + 'sus4';\n      break;\n    case '[2,7]':\n      name += root + 'sus2';\n      break;\n    case '[4,6]':\n      name += root + 'b5';\n      break;\n    default:\n      break;\n  }\n  switch (ops.seventh) {\n    case '9':\n      name += 'dim7';\n      break;\n    case '10':\n      name += '7';\n      break;\n    case '11':\n      name += 'maj7';\n      break;\n    default:\n      break;\n  }\n  let extendeds = []\n  switch (ops.ninth) {\n    case '1':\n      extendeds.push('b9');\n      break;\n    case '2':\n      extendeds.push('9');\n      break;\n    case '3':\n      extendeds.push('#9');\n      break;\n    default:\n      break;\n  }\n  switch (ops.eleventh) {\n    case '5':\n      extendeds.push('11');\n      break;\n    case '6':\n      extendeds.push('#11');\n      break;\n    default:\n      break;\n  }\n  switch (ops.thirteenth) {\n    case '8':\n      extendeds.push('b13');\n      break;\n    case '9':\n      extendeds.push('13');\n      break;\n    case '10':\n      extendeds.push('#13');\n      break;\n    default:\n      break;\n  }\n  if (extendeds.length > 0) (\n    name += '(' + extendeds.join(',') + ')'\n  )\n  return name;\n}\n\nfunction getAudioFromTextin(ops) {\n  let fundamental = parseFloat(ops.fundamental)\n  let audio = [fundamental]\n  ops.value.split(', ').forEach(function(interval) {\n    if (interval.includes('/') && !interval.includes('.')) {\n      let num_dem = interval.split('/');\n      let numerator = parseInt(num_dem[0]);\n      let denominator = parseInt(num_dem[1]);\n      audio.push(fundamental * numerator / denominator);\n    } else if (interval.includes('.') && !interval.includes('/')) {\n      let cents = parseFloat(interval);\n      audio.push(fundamental * Math.pow(2, cents/1200));\n    }\n  })\n  return audio;\n}\n\nfunction play(audio, playtime, shape) {\n  let AudioContext = window.AudioContext || window.webkitAudioContext;\n  const ctx = new AudioContext();\n  let buffer = ctx.createBuffer(1, playtime * SAMPLE_RATE, SAMPLE_RATE);\n  let bufferSetter = buffer.getChannelData(0);\n  var generator = typeof shape == 'function' ? shape : shapes[shape];\n\n  for (let t = 0; t < playtime * SAMPLE_RATE; t++) {\n    audio.forEach(function(freq) {\n      bufferSetter[t] += generator(t, freq)\n    })\n  }\n\n  let source = ctx.createBufferSource();\n  source.buffer = buffer;\n  source.connect(ctx.destination);\n  source.start();\n}\n\nconst Sound = {\n  getAudio,\n  getAudioFromTextin,\n  getChordName,\n  play\n}\n\nexport default Sound;\n"]},"metadata":{},"sourceType":"module"}