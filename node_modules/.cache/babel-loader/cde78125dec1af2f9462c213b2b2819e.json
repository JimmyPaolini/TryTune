{"ast":null,"code":"const tone = require('tonegenerator');\n\nconst header = require('waveheader');\n\nconst fs = require('fs');\n\nfunction harmony(freqs = 440, time = 2, shape = 'sine') {\n  if (typeof freqs === 'number') {\n    return tone({\n      freq: freqs,\n      lengthInSecs: time,\n      volume: tone.MAX_16,\n      rate: 44100,\n      shape: shape\n    });\n  } else if (freqs !== null && typeof freqs === 'object') {\n    let tones = [];\n\n    for (let i = 0; i < freqs.length; i++) {\n      tones.push(tone({\n        freq: freqs[i],\n        lengthInSecs: time,\n        volume: tone.MAX_16,\n        rate: 44100,\n        shape: shape\n      }));\n    }\n\n    let samples = [];\n\n    for (let i = 0; i < tones[0].length; i++) {\n      samples.push(0);\n\n      for (let j = 0; j < tones.length; j++) {\n        samples[i] += tones[j][i];\n      }\n\n      samples[i] /= tones.length;\n    }\n\n    return samples;\n  }\n}\n/*function melody(notes) {\n  let mel = []\n  for (let i = 0; i < notes.length; i++) {\n    mel = mel.concat(notes[i])\n  }\n  return mel\n}*/\n\n\nfunction writeAudio(samples) {\n  let file = fs.createWriteStream('components/audio/cur.wav');\n  file.write(header(samples.length * 2, {\n    bitDepth: 16\n  }));\n  let data = Int16Array.from(samples);\n  let buffer = Buffer.allocUnsafe(data.length * 2); // 2 bytes per sample\n\n  data.forEach(function (value, index) {\n    buffer.writeInt16LE(value, index * 2);\n  });\n  file.write(buffer);\n  file.end();\n}\n/*this.state = {\nplaytime: '5',\nfundamental: '440',\nshape: 'sine',\nroot: '0',\nrootBNS: '0',\ntriad: '[4,7]',\nseventh: 'none',\nninth: 'none',\neleventh: 'none',\nthirteenth: 'none',\n}*/\n\n\nlet scale = new Array(24).fill(1).map((elt, i) => Math.pow(2, i / 12));\n\nfunction updateAudio(ops) {\n  let audio = []; //console.log('old ops ', ops)\n\n  ops = {\n    playtime: parseFloat(ops.playtime),\n    fundamental: parseFloat(ops.fundamental),\n    shape: ops.shape,\n    root: parseInt(ops.root),\n    rootBNS: parseInt(ops.rootBNS),\n    triad: JSON.parse(ops.triad),\n    seventh: parseInt(ops.seventh),\n    ninth: parseInt(ops.ninth),\n    eleventh: parseInt(ops.eleventh),\n    thirteenth: parseInt(ops.thirteenth) //console.log('new ops ', ops)\n\n  };\n  let root = ops.root + ops.rootBNS;\n  let third = ops.triad[0];\n  let fifth = ops.triad[1];\n  audio.push(ops.fundamental * scale[root]);\n  audio.push(ops.fundamental * scale[root + third]);\n  audio.push(ops.fundamental * scale[root + fifth]);\n  if (!isNaN(ops.seventh)) audio.push(ops.fundamental * scale[root + ops.seventh]);\n  if (!isNaN(ops.ninth)) audio.push(ops.fundamental * scale[root + ops.ninth]);\n  if (!isNaN(ops.eleventh)) audio.push(ops.fundamental * scale[root + ops.eleventh]);\n  if (!isNaN(ops.thirteenth)) audio.push(ops.fundamental * scale[root + ops.thirteenth]);\n  writeAudio(harmony(audio, ops.playtime, ops.shape));\n}\n\nexport default updateAudio;","map":{"version":3,"sources":["/Users/jimmy/Documents/trytune/src/trytune.js"],"names":["tone","require","header","fs","harmony","freqs","time","shape","freq","lengthInSecs","volume","MAX_16","rate","tones","i","length","push","samples","j","writeAudio","file","createWriteStream","write","bitDepth","data","Int16Array","from","buffer","Buffer","allocUnsafe","forEach","value","index","writeInt16LE","end","scale","Array","fill","map","elt","Math","pow","updateAudio","ops","audio","playtime","parseFloat","fundamental","root","parseInt","rootBNS","triad","JSON","parse","seventh","ninth","eleventh","thirteenth","third","fifth","isNaN"],"mappings":"AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAC,eAAD,CAApB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,YAAD,CAAtB;;AACA,MAAME,EAAE,GAAGF,OAAO,CAAC,IAAD,CAAlB;;AAEA,SAASG,OAAT,CAAiBC,KAAK,GAAC,GAAvB,EAA4BC,IAAI,GAAC,CAAjC,EAAoCC,KAAK,GAAC,MAA1C,EAAkD;AAChD,MAAI,OAAOF,KAAP,KAAiB,QAArB,EAA+B;AAC7B,WAAOL,IAAI,CAAC;AACVQ,MAAAA,IAAI,EAAEH,KADI;AAEVI,MAAAA,YAAY,EAAEH,IAFJ;AAGVI,MAAAA,MAAM,EAAEV,IAAI,CAACW,MAHH;AAIVC,MAAAA,IAAI,EAAE,KAJI;AAKVL,MAAAA,KAAK,EAAEA;AALG,KAAD,CAAX;AAOD,GARD,MAQO,IAAIF,KAAK,KAAK,IAAV,IAAkB,OAAOA,KAAP,KAAiB,QAAvC,EAAiD;AACtD,QAAIQ,KAAK,GAAG,EAAZ;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGT,KAAK,CAACU,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACrCD,MAAAA,KAAK,CAACG,IAAN,CAAWhB,IAAI,CAAC;AACdQ,QAAAA,IAAI,EAAEH,KAAK,CAACS,CAAD,CADG;AAEdL,QAAAA,YAAY,EAAEH,IAFA;AAGdI,QAAAA,MAAM,EAAEV,IAAI,CAACW,MAHC;AAIdC,QAAAA,IAAI,EAAE,KAJQ;AAKdL,QAAAA,KAAK,EAAEA;AALO,OAAD,CAAf;AAOD;;AACD,QAAIU,OAAO,GAAG,EAAd;;AACA,SAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAAC,CAAD,CAAL,CAASE,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACxCG,MAAAA,OAAO,CAACD,IAAR,CAAa,CAAb;;AACA,WAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGL,KAAK,CAACE,MAA1B,EAAkCG,CAAC,EAAnC,EAAuC;AACrCD,QAAAA,OAAO,CAACH,CAAD,CAAP,IAAcD,KAAK,CAACK,CAAD,CAAL,CAASJ,CAAT,CAAd;AACD;;AACDG,MAAAA,OAAO,CAACH,CAAD,CAAP,IAAcD,KAAK,CAACE,MAApB;AACD;;AACD,WAAOE,OAAP;AACD;AACF;AAED;;;;;;;;;AAQA,SAASE,UAAT,CAAoBF,OAApB,EAA6B;AAC3B,MAAIG,IAAI,GAAGjB,EAAE,CAACkB,iBAAH,CAAqB,0BAArB,CAAX;AACAD,EAAAA,IAAI,CAACE,KAAL,CAAWpB,MAAM,CAACe,OAAO,CAACF,MAAR,GAAiB,CAAlB,EAAqB;AAAEQ,IAAAA,QAAQ,EAAE;AAAZ,GAArB,CAAjB;AACA,MAAIC,IAAI,GAAGC,UAAU,CAACC,IAAX,CAAgBT,OAAhB,CAAX;AACA,MAAIU,MAAM,GAAGC,MAAM,CAACC,WAAP,CAAmBL,IAAI,CAACT,MAAL,GAAc,CAAjC,CAAb,CAJ2B,CAIsB;;AACjDS,EAAAA,IAAI,CAACM,OAAL,CAAa,UAAUC,KAAV,EAAiBC,KAAjB,EAAwB;AACnCL,IAAAA,MAAM,CAACM,YAAP,CAAoBF,KAApB,EAA2BC,KAAK,GAAG,CAAnC;AACD,GAFD;AAGAZ,EAAAA,IAAI,CAACE,KAAL,CAAWK,MAAX;AACAP,EAAAA,IAAI,CAACc,GAAL;AACD;AAED;;;;;;;;;;;;;;AAaA,IAAIC,KAAK,GAAG,IAAIC,KAAJ,CAAU,EAAV,EAAcC,IAAd,CAAmB,CAAnB,EAAsBC,GAAtB,CAA0B,CAACC,GAAD,EAAKzB,CAAL,KAAW0B,IAAI,CAACC,GAAL,CAAS,CAAT,EAAW3B,CAAC,GAAC,EAAb,CAArC,CAAZ;;AAEA,SAAS4B,WAAT,CAAqBC,GAArB,EAA0B;AACxB,MAAIC,KAAK,GAAG,EAAZ,CADwB,CAExB;;AACAD,EAAAA,GAAG,GAAG;AACJE,IAAAA,QAAQ,EAAEC,UAAU,CAACH,GAAG,CAACE,QAAL,CADhB;AAEJE,IAAAA,WAAW,EAAED,UAAU,CAACH,GAAG,CAACI,WAAL,CAFnB;AAGJxC,IAAAA,KAAK,EAAEoC,GAAG,CAACpC,KAHP;AAIJyC,IAAAA,IAAI,EAAEC,QAAQ,CAACN,GAAG,CAACK,IAAL,CAJV;AAKJE,IAAAA,OAAO,EAAED,QAAQ,CAACN,GAAG,CAACO,OAAL,CALb;AAMJC,IAAAA,KAAK,EAAEC,IAAI,CAACC,KAAL,CAAWV,GAAG,CAACQ,KAAf,CANH;AAOJG,IAAAA,OAAO,EAAEL,QAAQ,CAACN,GAAG,CAACW,OAAL,CAPb;AAQJC,IAAAA,KAAK,EAAEN,QAAQ,CAACN,GAAG,CAACY,KAAL,CARX;AASJC,IAAAA,QAAQ,EAAEP,QAAQ,CAACN,GAAG,CAACa,QAAL,CATd;AAUJC,IAAAA,UAAU,EAAER,QAAQ,CAACN,GAAG,CAACc,UAAL,CAVhB,CAYN;;AAZM,GAAN;AAcA,MAAIT,IAAI,GAAGL,GAAG,CAACK,IAAJ,GAAWL,GAAG,CAACO,OAA1B;AACA,MAAIQ,KAAK,GAAGf,GAAG,CAACQ,KAAJ,CAAU,CAAV,CAAZ;AACA,MAAIQ,KAAK,GAAGhB,GAAG,CAACQ,KAAJ,CAAU,CAAV,CAAZ;AACAP,EAAAA,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAD,CAAlC;AACAJ,EAAAA,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAI,GAAGU,KAAR,CAAlC;AACAd,EAAAA,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAI,GAAGW,KAAR,CAAlC;AAEA,MAAI,CAACC,KAAK,CAACjB,GAAG,CAACW,OAAL,CAAV,EACEV,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAI,GAAGL,GAAG,CAACW,OAAZ,CAAlC;AACF,MAAI,CAACM,KAAK,CAACjB,GAAG,CAACY,KAAL,CAAV,EACEX,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAI,GAAGL,GAAG,CAACY,KAAZ,CAAlC;AACF,MAAI,CAACK,KAAK,CAACjB,GAAG,CAACa,QAAL,CAAV,EACEZ,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAI,GAAGL,GAAG,CAACa,QAAZ,CAAlC;AACF,MAAI,CAACI,KAAK,CAACjB,GAAG,CAACc,UAAL,CAAV,EACEb,KAAK,CAAC5B,IAAN,CAAW2B,GAAG,CAACI,WAAJ,GAAkBZ,KAAK,CAACa,IAAI,GAAGL,GAAG,CAACc,UAAZ,CAAlC;AAEFtC,EAAAA,UAAU,CAACf,OAAO,CAACwC,KAAD,EAAQD,GAAG,CAACE,QAAZ,EAAsBF,GAAG,CAACpC,KAA1B,CAAR,CAAV;AACD;;AAED,eAAemC,WAAf","sourcesContent":["const tone = require('tonegenerator')\nconst header = require('waveheader')\nconst fs = require('fs')\n\nfunction harmony(freqs=440, time=2, shape='sine') {\n  if (typeof freqs === 'number') {\n    return tone({\n      freq: freqs,\n      lengthInSecs: time,\n      volume: tone.MAX_16,\n      rate: 44100,\n      shape: shape,\n    })\n  } else if (freqs !== null && typeof freqs === 'object') {\n    let tones = []\n    for (let i = 0; i < freqs.length; i++) {\n      tones.push(tone({\n        freq: freqs[i],\n        lengthInSecs: time,\n        volume: tone.MAX_16,\n        rate: 44100,\n        shape: shape,\n      }))\n    }\n    let samples = []\n    for (let i = 0; i < tones[0].length; i++) {\n      samples.push(0)\n      for (let j = 0; j < tones.length; j++) {\n        samples[i] += tones[j][i]\n      }\n      samples[i] /= tones.length\n    }\n    return samples\n  }\n}\n\n/*function melody(notes) {\n  let mel = []\n  for (let i = 0; i < notes.length; i++) {\n    mel = mel.concat(notes[i])\n  }\n  return mel\n}*/\n\nfunction writeAudio(samples) {\n  let file = fs.createWriteStream('components/audio/cur.wav')\n  file.write(header(samples.length * 2, { bitDepth: 16 }))\n  let data = Int16Array.from(samples)\n  let buffer = Buffer.allocUnsafe(data.length * 2) // 2 bytes per sample\n  data.forEach(function (value, index) {\n    buffer.writeInt16LE(value, index * 2)\n  })\n  file.write(buffer)\n  file.end()\n}\n\n/*this.state = {\nplaytime: '5',\nfundamental: '440',\nshape: 'sine',\nroot: '0',\nrootBNS: '0',\ntriad: '[4,7]',\nseventh: 'none',\nninth: 'none',\neleventh: 'none',\nthirteenth: 'none',\n}*/\n\nlet scale = new Array(24).fill(1).map((elt,i) => Math.pow(2,i/12))\n\nfunction updateAudio(ops) {\n  let audio = []\n  //console.log('old ops ', ops)\n  ops = {\n    playtime: parseFloat(ops.playtime),\n    fundamental: parseFloat(ops.fundamental),\n    shape: ops.shape,\n    root: parseInt(ops.root),\n    rootBNS: parseInt(ops.rootBNS),\n    triad: JSON.parse(ops.triad),\n    seventh: parseInt(ops.seventh),\n    ninth: parseInt(ops.ninth),\n    eleventh: parseInt(ops.eleventh),\n    thirteenth: parseInt(ops.thirteenth),\n  }\n  //console.log('new ops ', ops)\n\n  let root = ops.root + ops.rootBNS\n  let third = ops.triad[0]\n  let fifth = ops.triad[1]\n  audio.push(ops.fundamental * scale[root])\n  audio.push(ops.fundamental * scale[root + third])\n  audio.push(ops.fundamental * scale[root + fifth])\n\n  if (!isNaN(ops.seventh))\n    audio.push(ops.fundamental * scale[root + ops.seventh])\n  if (!isNaN(ops.ninth))\n    audio.push(ops.fundamental * scale[root + ops.ninth])\n  if (!isNaN(ops.eleventh))\n    audio.push(ops.fundamental * scale[root + ops.eleventh])\n  if (!isNaN(ops.thirteenth))\n    audio.push(ops.fundamental * scale[root + ops.thirteenth])\n\n  writeAudio(harmony(audio, ops.playtime, ops.shape))\n}\n\nexport default updateAudio;\n"]},"metadata":{},"sourceType":"module"}